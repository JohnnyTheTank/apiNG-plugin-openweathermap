
/*! aping-plugin-openweathermap v0.1.0 (12-12-2015) by Jonathan Hornung */
"use strict";var jjtApingOpenWeatherMap=angular.module("jtt_aping_openweathermap",["jtt_openweathermap"]).directive("apingOpenweathermap",["apingOpenWeatherMapHelper","apingUtilityHelper","openweathermapFactory",function(a,b,c){return{require:"?aping",restrict:"A",replace:"false",link:function(d,e,f,g){var h=g.getAppSettings(),i=b.parseJsonFromAttributes(f.apingOpenweathermap,a.getThisPlattformString(),h);i.forEach(function(d){var e={appid:b.getApiCredentials(a.getThisPlattformString(),"appid"),lang:d.lang||!1,units:d.units||"metric"};d.cityName?(e.q=d.cityName,d.countryCode&&(e.q+=","+d.countryCode),d.type&&(e.type=d.type),c.getWeatherFromCitySearchByName(e).success(function(b){g.concatToResults(a.getObjectByJsonData(b,h.model))}).error(function(a){})):d.cityId?(e.id=d.cityId,c.getWeatherFromCityById(e).success(function(b){g.concatToResults(a.getObjectByJsonData(b,h.model))}).error(function(a){})):d.lat&&d.lng?(e.lat=d.lat,e.lon=d.lng,c.getWeatherFromLocationByCoordinates(e).success(function(b){g.concatToResults(a.getObjectByJsonData(b,h.model))}).error(function(a){})):d.zip&&(e.zip=d.zip,d.countryCode&&(e.zip+=","+d.countryCode),c.getWeatherFromLocationByZipcode(e).success(function(b){g.concatToResults(a.getObjectByJsonData(b,h.model))}).error(function(a){}))})}}}]);jjtApingOpenWeatherMap.service("apingOpenWeatherMapHelper",["apingModels","apingTimeHelper","apingUtilityHelper",function(a,b,c){this.getThisPlattformString=function(){return"openweathermap"},this.getThisPlattformLink=function(){return"https://openweathermap.org/"},this.getObjectByJsonData=function(a,b){var c=[];if(a){var d=this;if(a.constructor===Array)a.items&&angular.forEach(a.items,function(a,e){var f=d.getItemByJsonData(a,b);f&&c.push(f)});else{var e=d.getItemByJsonData(a,b);e&&c.push(e)}}return c},this.getItemByJsonData=function(a,b){var c={};if(a&&b)switch(b){case"weather":c=this.getWeatherItemByJsonData(a);break;default:return!1}return c},this.getRainInfoFromObject=function(a){var b={duration:!1,volume:!1};return"object"==typeof a&&angular.forEach(a,function(a,c){b.duration=c,b.volume=a}),b},this.getWeatherInfoFromArray=function(a){var b={code:!1,caption:!1,text:!1,icon_name:!1,icon_url:!1};return a.constructor===Array&&(b.code=a[0].id||!1,b.caption=a[0].main||!1,b.text=a[0].description||!1,b.icon_name=a[0].icon||!1,b.icon_url=a[0].icon?"https://openweathermap.org/img/w/"+a[0].icon+".png":!1),b},this.getWeatherItemByJsonData=function(b){var c=a.getNew("weather",this.getThisPlattformString());if($.extend(!0,c,{temp:b.main?b.main.temp:!1,pressure:b.main?b.main.pressure:!1,humidity:b.main?b.main.humidity:!1,temp_min:b.main?b.main.temp_min:!1,temp_max:b.main?b.main.temp_max:!1,sea_level:b.main?b.main.sea_level:!1,grnd_level:b.main?b.main.grnd_level:!1,wind_speed:b.wind?b.wind.speed:!1,wind_deg:b.wind?b.wind.deg:!1,clouds:b.clouds?b.clouds.all:!1,timestamp:Date.now(),date_time:new Date,sunrise_timestamp:b.sys?b.sys.sunrise:!1,sunrise_date_time:b.sys?new Date(b.sys.sunrise):!1,sunset_timestamp:b.sys?b.sys.sunset:!1,sunset_date_time:b.sys?new Date(b.sys.sunset):!1,loc_city:b.name||!1,loc_city_id:b.id||!1,loc_country:b.sys?b.sys.country:!1,loc_lat:b.coord?b.coord.lat:!1,loc_lng:b.coord?b.coord.lon:!1}),b.rain){var d=this.getRainInfoFromObject(b.rain);c.rain_duration=d.duration||!1,c.rain_volume=d.volume||!1}if(b.weather){var e=this.getWeatherInfoFromArray(b.weather);c.weather_code=e.code||!1,c.weather_caption=e.caption||!1,c.weather_text=e.text||!1,c.weather_icon_name=e.icon_name||!1,c.weather_icon_url=e.icon_url||!1}return c}}]),angular.module("jtt_openweathermap",[]).factory("openweathermapFactory",["$http","openweathermapSearchDataService",function(a,b){var c={};return c.getWeatherFromCitySearchByName=function(c){var d=b.getNew("citySearchByName",c);return a({method:"GET",url:d.url,params:d.object})},c.getWeatherFromCityById=function(c){var d=b.getNew("cityById",c);return a({method:"GET",url:d.url,params:d.object})},c.getWeatherFromGroupOfCitiesById=function(c){var d=b.getNew("citiesById",c);return a({method:"GET",url:d.url,params:d.object})},c.getWeatherFromLocationByCoordinates=function(c){var d=b.getNew("locationByCoordinates",c);return a({method:"GET",url:d.url,params:d.object})},c.getWeatherFromLocationByZipcode=function(c){var d=b.getNew("locationByZipcode",c);return a({method:"GET",url:d.url,params:d.object})},c}]).service("openweathermapSearchDataService",function(){this.getApiBaseUrl=function(a){return"http://api.openweathermap.org/data/2.5/"},this.fillDataInObjectByList=function(a,b,c){return angular.forEach(c,function(c,d){"undefined"!=typeof b[c]&&(a.object[c]=b[c])}),a},this.getNew=function(a,b){var c={object:{appid:b.appid},url:""};switch(a){case"citySearchByName":c=this.fillDataInObjectByList(c,b,["q","lang","type","units"]),c.url=this.getApiBaseUrl()+"weather";break;case"cityById":c=this.fillDataInObjectByList(c,b,["id","lang","units"]),c.url=this.getApiBaseUrl()+"weather";break;case"citiesById":c=this.fillDataInObjectByList(c,b,["id","lang","units"]),c.url=this.getApiBaseUrl()+"group";break;case"locationByCoordinates":c=this.fillDataInObjectByList(c,b,["lat","lon","lang","units"]),c.url=this.getApiBaseUrl()+"weather";break;case"locationByZipcode":c=this.fillDataInObjectByList(c,b,["zip","lang","units"]),c.url=this.getApiBaseUrl()+"weather"}return c}});